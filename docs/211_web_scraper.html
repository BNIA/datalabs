---

title: 211 Web Scraper


keywords: fastai
sidebar: home_sidebar

summary: "Scrape 211 Data."
description: "Scrape 211 Data."
nb_path: "notebooks/02_211_web_scraper.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/02_211_web_scraper.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://mybinder.org/v2/gh/bnia/datalabs/main?filepath=%2Fnotebooks%2F02_211_web_scraper.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt="Binder"></a>
<a href="https://colab.research.google.com/github/bnia/datalabs/blob/main/notebooks/02_211_web_scraper.ipynb"><img src="https://pete88b.github.io/fastpages/assets/badges/colab.svg" alt="Binder"></a>
<a href="https://github.com/bnia/datalabs/tree/main/notebooks/02_211_web_scraper.ipynb"><img src="https://pete88b.github.io/fastpages/assets/badges/github.svg" alt="Binder"></a>
<a href="https://github.com/ellerbrock/open-source-badges/"><img src="https://badges.frapsoft.com/os/v3/open-source.svg?v=103" alt="Open Source Love svg3"></a></p>
<p><a href="https://github.com/bnia/datalabs/blob/main/LICENSE"><img src="https://img.shields.io/npm/l/all-contributors.svg?style=flat" alt="NPM License"></a>
<a href="https://bnia.github.io"><img src="http://img.shields.io/badge/Status-Active-green.svg" alt="Active"></a> 
<a href=""><img src="https://img.shields.io/github/last-commit/bnia/datalabs.svg?style=flat" alt="GitHub last commit"></a></p>
<p><a href="https://github.com/bnia/datalabs"><img src="https://img.shields.io/github/stars/bnia/datalabs.svg?style=social&amp;label=Star" alt="GitHub stars"></a> 
<a href="https://github.com/bnia/datalabs"><img src="https://img.shields.io/github/watchers/bnia/datalabs.svg?style=social&amp;label=Watch" alt="GitHub watchers"></a> 
<a href="https://github.com/bnia/datalabs"><img src="https://img.shields.io/github/forks/bnia/datalabs.svg?style=social&amp;label=Fork" alt="GitHub forks"></a> 
<a href="https://github.com/bnia/datalabs"><img src="https://img.shields.io/github/followers/bnia.svg?style=social&amp;label=Follow" alt="GitHub followers"></a></p>
<p><a href="https://twitter.com/intent/tweet?text=Check%20out%20this%20%E2%9C%A8%20colab%20by%20@bniajfi%20https://github.com/bnia/datalabs%20%F0%9F%A4%97"><img src="https://img.shields.io/twitter/url/https/github.com/bnia/datalabs.svg?style=social" alt="Tweet"></a> 
<a href="https://twitter.com/bniajfi"><img src="https://img.shields.io/twitter/follow/bniajfi.svg?style=social" alt="Twitter Follow"></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will need these libraries</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">mechanicalsoup</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://md-dc.211counts.org/dashBoard/barChart&#39;</span>
<span class="c1"># And these are the paramaters that get submitted to the endpoint as a POST request</span>
<span class="n">myobj</span> <span class="o">=</span> <span class="p">{</span>
<span class="s1">&#39;identifierCategory&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="s1">&#39;sourceType&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="s1">&#39;fromMobile&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ids&quot;</span><span class="p">:[</span><span class="mi">14160</span><span class="p">]},</span>
<span class="s1">&#39;timeIntervalId&#39;</span><span class="p">:</span> <span class="mi">333</span><span class="p">,</span>
<span class="s1">&#39;centerId&#39;</span><span class="p">:</span> <span class="mi">43</span><span class="p">,</span>
<span class="s1">&#39;fromDate&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="s1">&#39;toDate&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Z&#39;</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Miner">Miner<a class="anchor-link" href="#Miner"> </a></h2><p>(Works, but html content needs to be scraped seperately, through a same-origin request)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This needs additional scraping, but now each record has its respective html is isolated.</span>
<span class="k">def</span> <span class="nf">scrape</span><span class="p">(</span><span class="n">html_data</span><span class="p">):</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_data</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="n">categories</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;categories&quot;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">categories</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;zipCodeId&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[]})</span>
<span class="n">formValues</span> <span class="o">=</span> <span class="n">htmlText</span>
<span class="c1"># Loop through array of html containing our data</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scrape</span><span class="p">(</span><span class="n">formValues</span><span class="p">):</span>
  <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
  <span class="c1"># get the title and value from the records html</span>
  <span class="n">title</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;toolTipSubCategory&quot;</span><span class="p">})</span>
  <span class="n">value</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;data-value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
  <span class="c1"># append it to our dataframe if both value and title exit</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span> <span class="p">):</span> 
    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">text</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;data-value&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;zipCodeId&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="mi">14174</span><span class="p">),</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;test123.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">htmlText</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This needs additional scraping, but now each record has its respective html is isolated.</span>
<span class="k">def</span> <span class="nf">scrape</span><span class="p">(</span><span class="n">html_data</span><span class="p">):</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_data</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="n">categories</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;categories&quot;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">categories</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;test123.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Scraper">Scraper<a class="anchor-link" href="#Scraper"> </a></h2><p>(Works but doesnt give us what we want)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Get the page</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">browser</span> <span class="o">=</span> <span class="n">mechanicalsoup</span><span class="o">.</span><span class="n">StatefulBrowser</span><span class="p">()</span>
<span class="n">browser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;https://md-dc.211counts.org/&quot;</span><span class="p">)</span>
<span class="n">browser</span><span class="o">.</span><span class="n">get_url</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Find the form and select our options</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">browser</span><span class="o">.</span><span class="n">select_form</span><span class="p">(</span><span class="s1">&#39;div[id=&quot;search&quot;]&#39;</span><span class="p">)</span>
<span class="n">browser</span><span class="p">[</span><span class="s1">&#39;chkZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;14160&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">submit_selected</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Save the output for previewing</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">text_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;sample.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">text_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c1"># print(response.text)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unfortunately, this does not work!</p>
<p>Our data is stored as dynamic content that is not delivered to us here.</p>
<p>We will need to use Pupeteer to render the dynamic javascript content.</p>
<p>What a shame...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Final-Solution-(Javascript)">Final Solution (Javascript)<a class="anchor-link" href="#Final-Solution-(Javascript)"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This needs to be ran in a seperate js file.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">/*</span>
 <span class="o">*</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">stackoverflow</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">questions</span><span class="o">/</span><span class="mi">48681145</span><span class="o">/</span><span class="nb">set</span><span class="o">-</span><span class="n">pupeteer</span><span class="o">-</span><span class="n">window</span><span class="o">-</span><span class="n">size</span><span class="o">-</span><span class="n">when</span><span class="o">-</span><span class="n">running</span><span class="o">-</span><span class="ow">not</span><span class="o">-</span><span class="n">headless</span><span class="o">-</span><span class="ow">not</span><span class="o">-</span><span class="n">viewport</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">medium</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="nd">@aslushnikov</span><span class="o">/</span><span class="n">automating</span><span class="o">-</span><span class="n">clicks</span><span class="o">-</span><span class="ow">in</span><span class="o">-</span><span class="n">chromium</span><span class="o">-</span><span class="n">a50e7f01d3fb</span>
<span class="o">*</span> 
<span class="o">*/</span>
<span class="n">const</span> <span class="n">puppeteer</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;puppeteer&#39;</span><span class="p">);</span>
<span class="n">var</span> <span class="n">zipCodes</span> <span class="o">=</span> <span class="p">{</span> 
  <span class="s1">&#39;21201&#39;</span><span class="p">:</span><span class="mi">11175</span><span class="p">,</span> 
  <span class="s1">&#39;21202&#39;</span><span class="p">:</span><span class="mi">11176</span><span class="p">,</span> 
  <span class="s1">&#39;21203&#39;</span><span class="p">:</span><span class="mi">14550</span><span class="p">,</span> 
  <span class="s1">&#39;21204&#39;</span><span class="p">:</span><span class="mi">11177</span><span class="p">,</span> 
  <span class="s1">&#39;21205&#39;</span><span class="p">:</span><span class="mi">11178</span><span class="p">,</span> 
  <span class="s1">&#39;21206&#39;</span><span class="p">:</span><span class="mi">11179</span><span class="p">,</span> 
  <span class="s1">&#39;21207&#39;</span><span class="p">:</span><span class="mi">11180</span><span class="p">,</span> 
  <span class="s1">&#39;21208&#39;</span><span class="p">:</span><span class="mi">11181</span><span class="p">,</span>
  <span class="s1">&#39;21209&#39;</span><span class="p">:</span><span class="mi">11182</span><span class="p">,</span> 
  <span class="s1">&#39;21210&#39;</span><span class="p">:</span><span class="mi">11183</span><span class="p">,</span> 
  <span class="s1">&#39;21211&#39;</span><span class="p">:</span><span class="mi">11184</span><span class="p">,</span> 
  <span class="s1">&#39;21212&#39;</span><span class="p">:</span><span class="mi">11185</span><span class="p">,</span> 
  <span class="s1">&#39;21213&#39;</span><span class="p">:</span><span class="mi">11373</span><span class="p">,</span> 
  <span class="s1">&#39;21214&#39;</span><span class="p">:</span><span class="mi">11375</span><span class="p">,</span> 
  <span class="s1">&#39;21215&#39;</span><span class="p">:</span><span class="mi">11376</span><span class="p">,</span> 
  <span class="s1">&#39;21216&#39;</span><span class="p">:</span><span class="mi">11377</span><span class="p">,</span>
  <span class="s1">&#39;21217&#39;</span><span class="p">:</span><span class="mi">11378</span><span class="p">,</span> 
  <span class="s1">&#39;21218&#39;</span><span class="p">:</span><span class="mi">11379</span><span class="p">,</span> 
  <span class="s1">&#39;21219&#39;</span><span class="p">:</span><span class="mi">11380</span><span class="p">,</span> 
  <span class="s1">&#39;21220&#39;</span><span class="p">:</span><span class="mi">11381</span><span class="p">,</span> 
  <span class="s1">&#39;21221&#39;</span><span class="p">:</span><span class="mi">11382</span><span class="p">,</span> 
  <span class="s1">&#39;21222&#39;</span><span class="p">:</span><span class="mi">11383</span><span class="p">,</span> 
  <span class="s1">&#39;21223&#39;</span><span class="p">:</span><span class="mi">11384</span><span class="p">,</span> 
  <span class="s1">&#39;21224&#39;</span><span class="p">:</span><span class="mi">11385</span><span class="p">,</span> 
  <span class="s1">&#39;21225&#39;</span><span class="p">:</span><span class="mi">11386</span><span class="p">,</span> 
  <span class="s1">&#39;21226&#39;</span><span class="p">:</span><span class="mi">11387</span><span class="p">,</span> 
  <span class="s1">&#39;21227&#39;</span><span class="p">:</span><span class="mi">11388</span><span class="p">,</span> 
  <span class="s1">&#39;21228&#39;</span><span class="p">:</span><span class="mi">11389</span><span class="p">,</span> 
  <span class="s1">&#39;21229&#39;</span><span class="p">:</span><span class="mi">11390</span><span class="p">,</span> 
  <span class="s1">&#39;21230&#39;</span><span class="p">:</span><span class="mi">11391</span><span class="p">,</span>
  <span class="s1">&#39;21231&#39;</span><span class="p">:</span><span class="mi">11392</span><span class="p">,</span> 
<span class="p">};</span>
<span class="n">let</span> <span class="n">nomatch</span> <span class="o">=</span> <span class="p">[</span> 
  <span class="s1">&#39;21232&#39;</span><span class="p">,</span> 
  <span class="s1">&#39;14550&#39;</span><span class="p">,</span> 
  <span class="s1">&#39;11177&#39;</span><span class="p">,</span> 
  <span class="s1">&#39;11178&#39;</span><span class="p">,</span> 
  <span class="s1">&#39;11178&#39;</span><span class="p">,</span> 
  <span class="s1">&#39;11189&#39;</span>
<span class="p">]</span>

<span class="n">var</span> <span class="n">finalData</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">Init</span> <span class="n">url</span> <span class="n">to</span> <span class="n">scrape</span><span class="p">,</span> <span class="n">load</span> <span class="n">browser</span> <span class="ow">and</span> <span class="n">page</span>
  <span class="n">const</span> <span class="n">browser</span> <span class="o">=</span> <span class="k">await</span> <span class="n">puppeteer</span><span class="o">.</span><span class="n">launch</span><span class="p">({</span>
    <span class="n">headless</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="o">//</span> <span class="n">The</span> <span class="n">browser</span> <span class="ow">is</span> <span class="n">visible</span>
    <span class="n">ignoreHTTPSErrors</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="n">args</span><span class="p">:</span> <span class="p">[</span><span class="err">`</span><span class="o">--</span><span class="n">window</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span><span class="mi">1000</span><span class="err">`</span><span class="p">]</span> <span class="o">//</span> <span class="n">new</span> <span class="n">option</span>
  <span class="p">})</span>
                            
  <span class="n">const</span> <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="n">browser</span><span class="o">.</span><span class="n">newPage</span><span class="p">()</span>
  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="s1">&#39;https://md-dc.211counts.org/&#39;</span><span class="p">)</span>
  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">setViewport</span><span class="p">({</span> <span class="n">width</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">1000</span> <span class="p">})</span>
  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">waitForSelector</span><span class="p">(</span><span class="s1">&#39;#mainContent #identifierCategory&#39;</span><span class="p">)</span>
  <span class="o">//</span> <span class="n">Click</span> <span class="n">Covid</span><span class="o">-</span><span class="mi">19</span> <span class="n">Checkbox</span>
  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="s1">&#39;#mainContent #identifierCategory&#39;</span><span class="p">)</span> 
  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">waitForSelector</span><span class="p">(</span><span class="s1">&#39;#mainContent #displayCount&#39;</span><span class="p">)</span>
  <span class="o">//</span> <span class="n">Click</span> <span class="n">Radio</span> <span class="n">Button</span>
  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="s1">&#39;#mainContent #displayCount&#39;</span><span class="p">)</span>
  <span class="o">//</span> <span class="n">Click</span> <span class="n">to</span> <span class="n">Expand</span> <span class="n">the</span> <span class="n">Timestamp</span> <span class="n">Dropdown</span>
  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">713</span><span class="p">,</span> <span class="mi">37</span><span class="p">);</span>
  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">down</span><span class="p">({</span><span class="n">button</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">});</span>
  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">up</span><span class="p">({</span><span class="n">button</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">});</span>
  <span class="o">//</span> <span class="n">Click</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">dropdwn</span> <span class="s1">&#39;30 Days&#39;</span>
  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">688</span><span class="p">,</span> <span class="mi">194</span><span class="p">);</span>
  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">down</span><span class="p">({</span><span class="n">button</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">});</span>
  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">up</span><span class="p">({</span><span class="n">button</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">});</span> 
  <span class="o">//</span> <span class="n">Search</span> <span class="k">for</span> <span class="n">every</span> <span class="nb">zip</span> <span class="n">code</span> <span class="ow">and</span> <span class="n">add</span> <span class="n">the</span> <span class="n">result</span> <span class="n">to</span> <span class="n">an</span> <span class="nb">object</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">var</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">Object</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">zipCodes</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">var</span> <span class="n">currentZipCode</span> <span class="o">=</span> <span class="n">Object</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">zipCodes</span><span class="p">)[</span><span class="n">j</span><span class="p">]</span>
	<span class="n">var</span> <span class="n">zid</span> <span class="o">=</span> <span class="n">zipCodes</span><span class="p">[</span><span class="n">currentZipCode</span><span class="p">]</span>	 
	<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;CurZip: &quot;</span> <span class="o">+</span> <span class="n">currentZipCode</span><span class="p">,</span> <span class="s1">&#39; ID: &#39;</span><span class="p">,</span> <span class="s1">&#39;input[value=&quot;&#39;</span><span class="o">+</span><span class="n">zid</span><span class="o">+</span><span class="s1">&#39;&quot;]&#39;</span><span class="p">);</span>  
	<span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">((</span><span class="n">zc</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>	
	  <span class="o">//</span> <span class="n">Prepare</span> <span class="n">the</span> <span class="nb">zip</span> <span class="n">code</span> <span class="n">checkbox</span> <span class="n">identifier</span> <span class="n">to</span> <span class="n">click</span> <span class="n">on</span>
	  <span class="n">let</span> <span class="n">reset</span> <span class="o">=</span> <span class="s1">&#39;input[value=&quot;RESET&quot;]&#39;</span><span class="p">;</span>
	  <span class="err">$</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">();</span>
	  <span class="n">let</span> <span class="n">zipCodeCheckBox</span> <span class="o">=</span> <span class="s1">&#39;input[value=&quot;&#39;</span> <span class="o">+</span> <span class="n">zc</span>  <span class="o">+</span> <span class="s1">&#39;&quot;]&#39;</span><span class="p">;</span>
	  <span class="err">$</span><span class="p">(</span><span class="n">zipCodeCheckBox</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">();</span>
	  <span class="o">//</span> <span class="n">Get</span> <span class="n">search</span> <span class="n">button</span><span class="p">,</span> <span class="n">click</span>
      <span class="err">$</span><span class="p">(</span><span class="s2">&quot;#submitSearch&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">();</span>
	<span class="p">},</span> <span class="n">zid</span><span class="p">);</span>
	
	<span class="o">//</span> <span class="n">And</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">the</span> <span class="n">results</span> <span class="n">to</span> <span class="n">load</span>
	<span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">waitFor</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
	
	<span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">screenshot</span><span class="p">({</span><span class="n">path</span><span class="p">:</span> <span class="n">currentZipCode</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">});</span>
	
	<span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">((</span><span class="n">zc</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="o">//</span> <span class="n">Click</span> <span class="n">on</span> <span class="n">count</span> <span class="n">radio</span> <span class="n">button</span> 
		<span class="n">let</span> <span class="n">countsBtn</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s1">&#39;displayCount&#39;</span><span class="p">);</span>
		<span class="n">countsBtn</span><span class="o">.</span><span class="n">click</span><span class="p">();</span>
		<span class="o">//</span> <span class="n">Prepare</span> <span class="n">the</span> <span class="nb">zip</span> <span class="n">code</span> <span class="n">checkbox</span> <span class="n">identifier</span> <span class="n">to</span> <span class="n">click</span> <span class="n">on</span>
		<span class="n">let</span> <span class="n">zipCodeCheckBox</span> <span class="o">=</span> <span class="s1">&#39;input[value=&quot;&#39;</span> <span class="o">+</span> <span class="n">zc</span>  <span class="o">+</span> <span class="s1">&#39;&quot;]&#39;</span><span class="p">;</span>
		<span class="err">$</span><span class="p">(</span><span class="n">zipCodeCheckBox</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">();</span>
		<span class="o">//</span> <span class="n">Get</span> <span class="n">search</span> <span class="n">button</span><span class="p">,</span> <span class="n">click</span>
		<span class="err">$</span><span class="p">(</span><span class="s2">&quot;#submitSearch&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">();</span>
	<span class="p">},</span> <span class="n">currentZipCode</span><span class="p">);</span>
	<span class="o">//</span> <span class="n">And</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">the</span> <span class="n">results</span> <span class="n">to</span> <span class="n">load</span>
	<span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">waitFor</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
	<span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">screenshot</span><span class="p">({</span><span class="n">path</span><span class="p">:</span> <span class="n">currentZipCode</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">});</span>
		<span class="o">//</span> <span class="n">Then</span> <span class="n">we</span> <span class="n">grab</span> <span class="n">the</span> <span class="n">results</span>
	<span class="n">let</span> <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="o">//</span> <span class="n">Get</span> <span class="nb">all</span> <span class="n">categories</span> <span class="n">div</span>
	  <span class="n">let</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">querySelectorAll</span><span class="p">(</span><span class="s2">&quot;.categories&quot;</span><span class="p">);</span>
	  <span class="o">//</span> <span class="n">Iterate</span> <span class="n">through</span> <span class="nb">all</span> <span class="n">categories</span> <span class="ow">and</span> <span class="n">add</span> <span class="n">their</span> <span class="n">values</span> <span class="n">to</span> <span class="n">an</span> <span class="nb">object</span>
	  <span class="n">let</span> <span class="n">pointer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
	  <span class="n">let</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
	  <span class="k">while</span> <span class="p">(</span><span class="n">pointer</span> <span class="o">&lt;</span> <span class="n">categories</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">//</span> <span class="n">Now</span> <span class="n">we</span> <span class="n">have</span> <span class="n">access</span> <span class="n">to</span> <span class="n">two</span> <span class="n">categories</span>
		<span class="n">let</span> <span class="n">category</span> <span class="o">=</span> <span class="n">categories</span><span class="p">[</span><span class="n">pointer</span><span class="p">];</span>
		<span class="o">//</span> <span class="n">Making</span> <span class="n">sure</span> <span class="n">we</span> <span class="n">have</span> <span class="n">both</span> <span class="n">a</span> <span class="n">label</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">null</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">category</span> <span class="o">!=</span> <span class="n">null</span> <span class="o">&amp;&amp;</span> <span class="n">category</span> <span class="o">!=</span> <span class="n">undefined</span> <span class="o">&amp;&amp;</span> <span class="n">category</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		  <span class="n">let</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> 
		  <span class="n">let</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
		  <span class="n">let</span> <span class="n">percentage</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
		  <span class="k">for</span> <span class="p">(</span><span class="n">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">category</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">let</span> <span class="n">node</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="o">//</span> <span class="n">Make</span> <span class="n">sure</span> <span class="n">that</span> <span class="n">the</span> <span class="n">node</span> <span class="ow">is</span> <span class="n">either</span> <span class="n">a</span> <span class="n">label</span> <span class="ow">or</span> <span class="n">a</span> <span class="n">paragraph</span><span class="p">,</span> <span class="n">can</span><span class="s1">&#39;t rely on indices alone</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="o">.</span><span class="n">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;label&#39;</span><span class="p">)</span> <span class="p">{</span>
			  <span class="n">label</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">querySelector</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">innerText</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="o">.</span><span class="n">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;p&#39;</span><span class="p">)</span> <span class="p">{</span>
			  <span class="n">value</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">querySelector</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s2">&quot;data-value&quot;</span><span class="p">);</span>
			  <span class="n">percentage</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">querySelector</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s2">&quot;data-percentage&quot;</span><span class="p">);</span>
		    <span class="p">}</span>  
		  <span class="p">}</span>
		  <span class="n">data</span><span class="p">[</span><span class="n">label</span> <span class="o">+</span> <span class="s2">&quot; Count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
		  <span class="n">data</span><span class="p">[</span><span class="n">label</span> <span class="o">+</span> <span class="s2">&quot; Percent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">percentage</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">pointer</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	  <span class="p">}</span>
	  <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
	<span class="p">});</span>
	<span class="o">//</span> <span class="n">Now</span> <span class="n">we</span> <span class="n">add</span> <span class="n">this</span> <span class="nb">zip</span> <span class="n">code</span><span class="s1">&#39;s result to the final answer</span>
	<span class="n">finalData</span><span class="p">[</span><span class="n">currentZipCode</span><span class="o">.</span><span class="n">toString</span><span class="p">()]</span> <span class="o">=</span> <span class="n">result</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">finalData</span><span class="p">));</span>

  <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">waitFor</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span> 
  
  
  <span class="o">//</span> <span class="k">await</span> <span class="n">browser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="p">})()</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

